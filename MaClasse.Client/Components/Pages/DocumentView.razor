@page "/documents/view/{ConcatString}"

<PageTitle>Document : @(document?.Name ?? "Chargement...")</PageTitle>

    <div class="d-flex flex-column align-items-center justify-content-center">
        @if (isLoading)
        {
            <MudProgressCircular Indeterminate Color="Color.Primary" />
            <MudText Class="mt-2">Chargement du document...</MudText>
        }
        else if (document != null)
        {
            <h3 class="mb-4">Visualisation : @document.Name</h3>

            @if (IsPdf(document.Format))
            {
                <div style="width: 100%; height: 90vh; overflow: auto; border: 1px solid #ccc;">
                    @* <object data="@document.Url" type="application/pdf" width="100%" height="600px"> *@
                    @*     <p>Votre navigateur ne supporte pas l'affichage des PDFs intégrés. Vous pouvez <a href="@document.Url" target="_blank">télécharger le PDF ici</a>.</p> *@
                    @* </object> *@
                    <iframe src="@PdfViewUrl" style="width: 100%; height: 100%; border: none;">
                        <p>
                            Votre navigateur ne supporte pas l'affichage de ce type de documents intégrés.
                            Vous pouvez <a href="@document.Url" target="_blank" rel="noopener noreferrer">télécharger le PDF ici</a>.
                        </p>
                    </iframe>
                </div>
                
            }
            else if (IsImage(document.Format))
            {
                <div style="max-width: 100%; max-height: 80vh; overflow: auto; border: 1px solid #ccc;">
                    <img src="@document.Url" alt="@document.Name" style="max-width: 100%; height: auto; border: 1px solid #ddd; border-radius: 4px;"/>
                </div>
            }
            else
            {
                <MudText Typo="Typo.h5" Color="Color.Error">Type de fichier non pris en charge pour l'affichage direct.</MudText>
                <MudButton Href="@document.Url" Target="_blank" Variant="MudBlazor.Variant.Filled" Color="Color.Primary" Class="mt-4">Télécharger le fichier</MudButton>
            }
        }
        else
        {
            <MudText Typo="Typo.h5" Color="Color.Warning">Document introuvable ou URL manquante.</MudText>
        }
        
    </div>

@* @code { *@
@* *@
@*     [Inject] *@
@*     public NavigationManager NavigationManager { get; set; } *@
@* *@
@*     private static readonly string[] ImageFormats = { "png", "jpg", "jpeg", "bmp", "gif", "webp", "image/png", "image/jpeg" }; *@
@*     private static readonly string[] PdfFormats = { "pdf", "application/pdf" }; *@
@* *@
@*     private bool IsImage(string format) *@
@*         => !string.IsNullOrEmpty(format) && ImageFormats.Any(f => f.Equals(format, StringComparison.OrdinalIgnoreCase)); *@
@* *@
@*     private bool IsPdf(string format) *@
@*         => !string.IsNullOrEmpty(format) && PdfFormats.Any(f => f.Equals(format, StringComparison.OrdinalIgnoreCase)); *@
@*      *@
@* } *@